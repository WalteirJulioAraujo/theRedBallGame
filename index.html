<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <style>
        body {
            background: #ccc;
            margin: 0;
        }
    </style>
</head>

<body>
    <canvas id="canvas" onmousemove="onMouseMove(event)" onclick="startGame()"></canvas>

    <script src="Ball.js" ></script>
    <script src="AutomaticBall.js" ></script>
    <script src="Enemy.js"></script>
    <script src="Player.js"></script>

    <script>
        const screenWidth = window.innerWidth;
        const screenHeight = window.innerHeight;

        const canvas = document.querySelector("#canvas");
        canvas.width = screenWidth;
        canvas.height = screenHeight;
        const context = canvas.getContext("2d");

        let intervalId;

        let player = new Player(screenWidth/2,screenHeight/2);
        let enemy = new Enemy(0,0);

        function onMouseMove(event) {
            x = event.clientX;
            y = event.clientY;
            player.moveTo(x,y);
        }

        function drawCircle(x, y, radius, color) {
            context.beginPath();
            context.fillStyle = color;
            context.arc(x, y, radius, 0, 2 * Math.PI);
            context.fill();
        }

        function clearScreen() {
            context.clearRect(0, 0, canvas.width, canvas.height);
        }

        function checkEnemyCollision() {
            const distance = Math.sqrt(
                (player.x - enemy.x) ** 2 + (player.y - enemy.y) ** 2
            );

            return distance < player.radius + enemy.radius;
        }

        function endGame() {
            alert("Fim do jogo!");
            clearInterval(intervalId);
        }

        function startGame() {
            player = new Player(screenWidth/2,screenHeight/2);
            enemy = new Enemy(0,0);

            const fps = 1000/60;

            clearInterval(intervalId);
            intervalId = setInterval(gameLoop, fps);
        }

        function gameLoop() {
            updateState();
            renderGame();
        }   

        function updateState(){
            enemy.move();

            if (checkEnemyCollision()) {
                endGame();
            }

            enemy.bounceOnEdge();
            enemy.increaseSpeed();
        }

        function renderGame(){
            clearScreen();
            player.draw();
            enemy.draw();
        }

        startGame();
    </script>
</body>

</html>